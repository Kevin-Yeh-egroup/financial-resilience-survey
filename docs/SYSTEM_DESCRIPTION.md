# 財務韌性問卷系統 - 完整程式描述

## 系統概述

這是一個基於 Next.js 和 React 開發的互動式財務韌性評估問卷系統。系統透過 10 個精心設計的問題，評估使用者的家庭財務狀況，並提供多維度的分析結果、視覺化圖表，以及個人化的結構型判讀與優先改善方向建議。

## 系統架構

### 技術棧
- **前端框架**: Next.js 16（App Router）
- **UI 框架**: React 19
- **樣式系統**: Tailwind CSS
- **圖表庫**: Recharts（用於雷達圖）
- **圖標庫**: Lucide React
- **程式語言**: TypeScript
- **狀態管理**: React Hooks（useState）

### 專案結構

```
財務韌性-初測/
├── app/                          # Next.js 應用程式層
│   ├── page.tsx                 # 主頁面（流程控制中心）
│   ├── layout.tsx               # 應用程式佈局
│   └── globals.css              # 全域樣式
├── components/                   # React 組件層
│   ├── questionnaire-form.tsx   # 問卷表單組件
│   ├── results-display.tsx      # 結果顯示組件
│   ├── transition-animation.tsx  # 轉換動畫組件
│   └── ui/                      # 可重用 UI 組件庫
├── lib/                         # 核心業務邏輯層
│   ├── questionnaire-data.ts    # 問卷題目數據
│   ├── scoring.ts               # 分數計算與判讀邏輯
│   └── utils.ts                 # 工具函數
├── types/                       # TypeScript 類型定義
│   └── questionnaire.ts         # 問卷相關類型
└── docs/                        # 文檔資料夾
```

## 核心功能模組

### 1. 問卷填寫模組（QuestionnaireForm）

**位置**: `components/questionnaire-form.tsx`

**功能描述**:
- 呈現 10 道財務相關問題，每題提供 4 個選項（A、B、C、D）
- 每題選項對應不同分數（0、3、7、10 分）
- 單題顯示模式，一次只顯示一道問題
- 自動進度追蹤，顯示當前題目編號和完成百分比
- 選擇答案後自動延遲 300 毫秒進入下一題
- 支援返回上一題功能
- 選中答案時顯示視覺回饋（勾選圖標、邊框高亮）

**技術實現**:
- 使用 `useState` 管理當前題目索引、答案記錄、選中狀態
- 使用 RadioGroup 組件實現單選功能
- 使用 Progress 組件顯示進度條
- 答案以物件形式儲存：`{ 題目ID: 分數 }`

### 2. 轉換動畫模組（TransitionAnimation）

**位置**: `components/transition-animation.tsx`

**功能描述**:
- 在問卷完成後、結果顯示前播放過場動畫
- 顯示三行固定文案，傳達問卷的核心理念
- 包含多種動態效果：
  - 雙層旋轉載入動畫（兩個同心圓以不同方向旋轉）
  - 文字逐行淡入並上移動畫
  - 底部三個脈衝點動畫（不同延遲時間）
- 動畫持續 4 秒後自動進入結果頁面

**技術實現**:
- 使用 `useState` 控制文字顯示狀態
- 使用 `setInterval` 實現逐行顯示
- 使用 CSS 動畫和 Tailwind 類別實現視覺效果

### 3. 結果計算模組（Scoring）

**位置**: `lib/scoring.ts`

**功能描述**:
這是系統的核心計算引擎，負責將使用者的答案轉換為結構化的評估結果。

#### 3.1 總分計算
- 將所有題目的分數相加，得到 0-100 的總分
- 總分用於判斷整體財務韌性等級

#### 3.2 六構面分數計算
系統將 10 道題目對應到 6 個財務構面：
- **收入與穩定性**: 題目 1、2 的平均分 × 10
- **儲蓄與突發應對**: 題目 3、5 的平均分 × 10
- **債務壓力與風險保障**: 題目 4、6 的平均分 × 10
- **金錢管理與金融使用**: 題目 7、8 的平均分 × 10
- **支持資源與連結**: 題目 9 的分數 × 10
- **心理韌性與未來感**: 題目 10 的分數 × 10

每個構面分數範圍為 0-100。

#### 3.3 結構型判讀（A-E 五種類型）

系統根據六構面分數的分布模式，自動判斷使用者的財務結構類型：

- **A 型 - 單一支撐結構**: 收入與穩定性高（≥70），但其他多數構面低（≥3 個構面 <50）
- **B 型 - 撐著運作結構**: 儲蓄、金錢管理、心理韌性都偏低
- **C 型 - 人脈承接結構**: 支持資源高（≥70）且心理韌性高（≥70）
- **D 型 - 多元支撐結構**: 預設類型，多個構面達到中高水準
- **E 型 - 壓力集中結構**: 多個重要構面同時偏低（優先判斷）

#### 3.4 優先方向判斷

系統根據各題目的分數，自動判斷需要優先討論的方向：
- 緊急經濟援助（題 1 或題 5 ≤ 3 分）
- 債務管理（題 4 ≤ 3 分）
- 儲蓄培養（題 3 ≤ 3 分）
- 金融教育（題 7 或題 8 ≤ 3 分）
- 就業支持（題 2 ≤ 3 分）
- 金融服務連結（題 6 ≤ 3 分）
- 社會網絡建立（題 9 ≤ 3 分）
- 心理支持（題 10 ≤ 3 分）

可同時顯示多個優先方向。

#### 3.5 等級判斷

根據總分判斷財務韌性等級（用於顏色顯示）：
- 75-100 分：resilient（財務韌性良好）
- 60-74 分：approaching（接近韌性）
- 40-59 分：fragile（財務較脆弱）
- 0-39 分：highly-fragile（高度脆弱）

### 4. 結果顯示模組（ResultsDisplay）

**位置**: `components/results-display.tsx`

**功能描述**:
這是系統最複雜的組件，負責以視覺化的方式呈現完整的評估結果。

#### 4.1 整體財務韌性分數區塊

- **顯示內容**:
  - 大型數字顯示總分（0-100）
  - 分數區間標籤（財務韌性良好/接近韌性/財務較脆弱/高度脆弱）
  - 根據分數區間顯示對應顏色的卡片背景
  - 置中的回饋文字卡片，包含個人化的建議文字

- **分數區間配置**:
  - 75-100 分：綠色系（財務韌性良好）
  - 60-74 分：黃色系（接近韌性）
  - 40-59 分：橙色系（財務較脆弱）
  - 0-39 分：紅色系（高度脆弱）

#### 4.2 六構面雷達圖

- **技術實現**: 使用 Recharts 的 RadarChart 組件
- **顯示內容**:
  - 六個構面以雷達圖形式呈現
  - 每個構面軸上顯示構面名稱和對應分數
  - 以填充的多邊形顯示財務涵蓋面積
  - 支援 Tooltip 顯示詳細數值

- **視覺設計**:
  - 主色調填充，透明度 40%
  - 邊框線條寬度 2.5px
  - 數據點以圓點標示，帶白色邊框

#### 4.3 結構判讀區塊

- **顯示內容**:
  - 標題「結構判讀」
  - 結構型名稱（如「單一支撐結構」）
  - 詳細的結構描述文字
  - 對應的插圖圖標

- **五種結構型對應的圖標**:
  - A 型：自定義 SVG 單支柱插圖（藍色）
  - B 型：Building2 圖標（橙色）
  - C 型：Network 圖標（紫色）
  - D 型：Layers 圖標（綠色）
  - E 型：AlertTriangle 圖標（紅色）

#### 4.4 優先討論方向區塊

- **顯示條件**: 僅在系統判斷出優先方向時顯示
- **顯示內容**:
  - 標題「目前可優先討論的方向」
  - 說明文字
  - 以卡片列表形式顯示所有優先方向
  - 每個方向以獨立的卡片呈現

#### 4.5 下一步行動區塊

- **顯示內容**:
  - 三個行動按鈕：
    - 個人財務諮詢
    - 問問 AI
    - 紀錄本次測試結果
  - 目前所有按鈕標示為「開發中」狀態

#### 4.6 重新評估按鈕

- 允許使用者重新填寫問卷
- 點擊後重置所有狀態，返回問卷開始頁面

### 5. 主頁面流程控制（Home Page）

**位置**: `app/page.tsx`

**功能描述**:
這是整個系統的流程控制中心，管理三個主要狀態的切換。

**狀態管理**:
- `result`: 儲存計算完成的結果
- `showTransition`: 控制是否顯示轉換動畫
- `pendingResult`: 暫存等待顯示的結果

**流程邏輯**:
1. **初始狀態**: 顯示問卷表單（QuestionnaireForm）
2. **問卷完成**: 
   - 觸發 `handleComplete` 函數
   - 保存結果到 `pendingResult`
   - 設置 `showTransition` 為 true
   - 顯示轉換動畫（TransitionAnimation）
3. **動畫完成**:
   - 觸發 `handleTransitionComplete` 函數
   - 將 `pendingResult` 轉移到 `result`
   - 設置 `showTransition` 為 false
   - 顯示結果頁面（ResultsDisplay）
4. **重新評估**:
   - 觸發 `handleReset` 函數
   - 清空所有狀態
   - 返回問卷表單

## 數據流程

### 問卷填寫流程

```
使用者選擇答案
    ↓
記錄答案到 answers 物件 { 題目ID: 分數 }
    ↓
自動進入下一題（或完成問卷）
    ↓
所有題目完成後，調用 calculateResult(answers)
    ↓
計算總分、構面分數、結構型、優先方向
    ↓
返回 QuestionnaireResult 物件
    ↓
觸發 onComplete 回調
    ↓
主頁面接收結果，顯示轉換動畫
    ↓
動畫完成後顯示結果頁面
```

### 數據結構

#### Question（題目）
```typescript
{
  id: number,           // 題目編號（1-10）
  text: string,         // 題目文字
  options: Option[]     // 選項陣列
}
```

#### Option（選項）
```typescript
{
  label: string,        // 選項顯示文字
  value: string,        // 選項值（A/B/C/D）
  score: number         // 對應分數（0/3/7/10）
}
```

#### QuestionnaireResult（結果）
```typescript
{
  totalScore: number,                    // 總分（0-100）
  level: "resilient" | "approaching" | "fragile" | "highly-fragile",
  priorities: string[],                  // 優先方向陣列
  dimensionScores: DimensionScores,      // 六構面分數
  structureType: "A" | "B" | "C" | "D" | "E"
}
```

#### DimensionScores（構面分數）
```typescript
{
  收入與穩定性: number,
  儲蓄與突發應對: number,
  債務壓力與風險保障: number,
  金錢管理與金融使用: number,
  支持資源與連結: number,
  心理韌性與未來感: number
}
```

## 設計特色

### 1. 使用者體驗設計

- **單題顯示**: 避免資訊過載，專注於當前問題
- **自動進度**: 選擇答案後自動進入下一題，減少操作步驟
- **視覺回饋**: 選中答案時立即顯示視覺確認
- **進度追蹤**: 清楚顯示當前進度和完成百分比
- **流暢動畫**: 轉換動畫提供良好的過渡體驗

### 2. 視覺化設計

- **雷達圖**: 直觀展示六構面的分數分布
- **顏色編碼**: 不同分數區間使用不同顏色，快速識別狀態
- **結構插圖**: 每種結構型都有對應的視覺化圖標
- **響應式設計**: 支援手機、平板、桌面等不同螢幕尺寸

### 3. 個人化分析

- **多維度評估**: 不僅看總分，更分析六個構面的表現
- **結構型判讀**: 深入分析財務結構模式，提供結構化洞察
- **優先方向**: 根據弱項自動推薦改善方向
- **個人化回饋**: 根據分數區間提供對應的建議文字

## 可擴展性

### 配置化設計

系統設計時考慮了可重用性：
- 問卷題目可透過修改 `questionnaire-data.ts` 調整
- 構面設定可透過修改計算邏輯調整
- 文字內容可透過修改組件中的配置調整
- 樣式和顏色可透過 Tailwind CSS 類別調整

### 模組化架構

- 每個功能模組獨立，易於維護和擴展
- 組件之間透過 Props 和回調函數通訊
- 業務邏輯與 UI 分離，便於測試和重用

## 技術亮點

1. **TypeScript 類型安全**: 完整的類型定義，減少運行時錯誤
2. **React Hooks**: 使用現代 React 開發模式
3. **響應式設計**: 使用 Tailwind CSS 實現自適應佈局
4. **動畫效果**: 使用 CSS 動畫和 React 狀態管理實現流暢過渡
5. **組件化開發**: 可重用的 UI 組件庫，保持設計一致性

## 系統限制與注意事項

1. **固定題目數量**: 目前系統設計為 10 題，如需修改需要調整多處代碼
2. **固定構面數量**: 六構面設計，修改需要調整計算邏輯和類型定義
3. **結構型判斷**: 五種結構型的判斷邏輯是硬編碼的，需要手動調整
4. **無數據持久化**: 目前不儲存使用者的填答記錄
5. **無後端整合**: 所有計算在前端完成，無伺服器端驗證

## 未來擴展方向

1. **數據持久化**: 儲存使用者的填答記錄和歷史結果
2. **後端 API**: 將計算邏輯移至後端，提供更安全的數據處理
3. **多語言支援**: 國際化功能，支援多種語言
4. **結果匯出**: 支援將結果匯出為 PDF 或圖片
5. **比較功能**: 允許使用者比較不同時期的評估結果
6. **AI 整合**: 實現「問問 AI」功能，提供更智能的建議

## 總結

這是一個功能完整、設計精良的互動式問卷評估系統。它不僅提供了流暢的使用者體驗，還透過多維度分析和視覺化呈現，幫助使用者深入了解自己的財務狀況。系統採用現代化的技術棧和模組化設計，具有良好的可維護性和擴展性，可以作為其他類型問卷系統的基礎架構。



